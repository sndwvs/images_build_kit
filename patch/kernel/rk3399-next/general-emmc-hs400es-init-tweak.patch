This patch is required to boot some Rock Pi 4 and NanoPC T4 units
with kernel 5.3+ and is on par with how it is done in Rockchip's BSP.

diff --git a/drivers/mmc/core/mmc.c b/drivers/mmc/core/mmc.c
index de8fbc396..95858e554 100644
--- a/drivers/mmc/core/mmc.c
+++ b/drivers/mmc/core/mmc.c
@@ -1393,6 +1393,8 @@
 	 * SEND_STATUS reliably at the initial frequency.
 	 */
 	mmc_set_timing(host, MMC_TIMING_MMC_HS);
+	/* Set host controller to HS400 timing and frequency */
+	mmc_set_clock(host, card->ext_csd.hs_max_dtr);
 	mmc_set_bus_speed(card);
 
 	err = mmc_switch_status(card, true);
@@ -1426,9 +1428,6 @@
 		goto out_err;
 	}
 
-	/* Set host controller to HS400 timing and frequency */
-	mmc_set_timing(host, MMC_TIMING_MMC_HS400);
-
 	/* Controller enable enhanced strobe function */
 	host->ios.enhanced_strobe = true;
 	if (host->ops->hs400_enhanced_strobe)
