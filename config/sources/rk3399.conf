
source "$CWD/config/sources/rockchip.inc" || exit 1

SERIAL_CONSOLE_SPEED=1500000
SERIAL_CONSOLE=ttyS1

DDR=rk3399_ddr_800MHz_v1.22.bin
MINI_LOADER=rk3399_miniloader_v1.19.bin
BLOB_LOADER=rk3399_loader_v1.22.119.bin


case $BOARD_NAME in
    rockpro64|rock_pi_4)
                SERIAL_CONSOLE=ttyS2
                BOOT_LOADER_SOURCE="https://github.com/ayufan-rock64/linux-u-boot"
                BOOT_LOADER_DIR="u-boot-${BOARD_NAME}"
                BOOT_LOADER_BRANCH="rockchip-master::"
                BOOT_LOADER_BIN="rksd_loader.img"
                DDR=rk3399_ddr_933MHz_v1.22.bin
                BL31=rk3399_bl31_v1.28.elf

                case $BOARD_NAME in
                    rockpro64)
                                case $KERNEL_SOURCE in
                                    legacy)
                                            LINUX_SOURCE="https://github.com/ayufan-rock64/linux-kernel"
                                            KERNEL_BRANCH="release-4.4:tag:4.4.167-1187-rockchip-ayufan"
                                            KERNEL_DIR="linux-$SOCFAMILY-$KERNEL_SOURCE-${BOARD_NAME}"
                                    ;;
                                esac
                    ;;
                    rock_pi_4)
                                case $KERNEL_SOURCE in
                                    legacy)
                                            LINUX_SOURCE="https://github.com/radxa/kernel"
                                            KERNEL_BRANCH="release-4.4-rockpi4::"
                                            KERNEL_DIR="linux-$SOCFAMILY-$KERNEL_SOURCE-${BOARD_NAME}"
                                    ;;
                                esac
                    ;;
                esac
    ;;
    firefly_rk3399)
                case $KERNEL_SOURCE in
                    legacy)
                            LINUX_SOURCE="https://github.com/FireflyTeam/kernel"
                            KERNEL_BRANCH="stable::"
                            KERNEL_DIR="linux-$SOCFAMILY-$KERNEL_SOURCE-${BOARD_NAME}"
                    ;;
                esac
    ;;
esac




build_kernel_img()
{
    message "" "create" "kernel img"
    # create kernel for flash
    cd $BUILD/$OUTPUT/$IMAGES
    $SOURCE/$RKBIN/tools/mkkrnlimg -a $SOURCE/$KERNEL_DIR/arch/arm64/boot/Image kernel.img > /dev/null 2>&1 || exit 1
}


build_resource_img()
{
    message "" "create" "resource img"
    # create resource for flash
    cd $BUILD/$OUTPUT/$IMAGES
    $SOURCE/$RKBIN/tools/resource_tool $SOURCE/$KERNEL_DIR/logo.bmp \
    $SOURCE/$KERNEL_DIR/arch/arm64/boot/dts/rockchip/$DEVICE_TREE_BLOB > /dev/null 2>&1 || exit 1
}
