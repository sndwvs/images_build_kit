
source "$CWD/config/sources/rockchip.inc" || exit 1

SERIAL_CONSOLE_SPEED=1500000
SERIAL_CONSOLE=ttyS2

DDR=rk3328_ddr_333MHz_v1.17.bin
MINI_LOADER=rk322xh_miniloader_v2.50.bin
BLOB_LOADER=rk3328_loader_v1.17.250.bin
#BL31=rk322xh_bl31_v1.46.elf

ATF="true"
ATF_PLAT=rk3328


case ${BOARD_NAME} in
    rock64|rock_pi_e)
        USE_DDR_BLOB=yes
    ;;
#    station_m1)
#        BL31=rk322xh_bl31_v1.46.elf
#    ;;
esac


case $KERNEL_SOURCE in
    legacy)
            LINUX_SOURCE="https://github.com/ayufan-rock64/linux-kernel"
            KERNEL_BRANCH="release-4.4.202:tag:4.4.202-1237-rockchip-ayufan"
            KERNEL_DIR="linux-$SOCFAMILY-$KERNEL_SOURCE"
    ;;
esac




uboot_customization()
{
    if [[ $BOARD_NAME == station_m1 ]]; then
        LOAD_ADDRESS="0x200000"
        $SOURCE/$BOOT_LOADER_TOOLS_DIR/tools/loaderimage --pack --uboot u-boot-dtb.bin uboot.img $LOAD_ADDRESS >> $LOG 2>&1 || (message "err" "details" && exit 1) || exit 1
        install -Dm644 uboot.img $BUILD/$OUTPUT/$TOOLS/$BOARD_NAME/boot/uboot.img >> $LOG 2>&1 || (message "err" "details" && exit 1) || exit 1

        local BL31=rk322xh_bl31_v1.49.elf
        ln -fs $SOURCE/$RKBIN_DIR/bin/${SOCFAMILY:0:4}/$BL31 bl31.elf
        $SOURCE/$BOOT_LOADER_TOOLS_DIR/tools/trust_merger $CWD/config/atf/$SOCFAMILY/trust.ini >> $LOG 2>&1 || (message "err" "details" && exit 1) || exit 1
        install -Dm644 trust.img $BUILD/$OUTPUT/$TOOLS/$BOARD_NAME/boot/trust.img >> $LOG 2>&1 || (message "err" "details" && exit 1) || exit 1
    fi
}

